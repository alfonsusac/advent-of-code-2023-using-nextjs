const sample = `\\/\\
\\.|
.\\/`

const sample2 = `.|...\\....
|.-.\\.....
.....|-...
........|.
..........
.........\\
..../.\\\\..
.-.-/..|..
.|....-|.\\
..//.|....`

const sample3 = `...`
const puzzle = `\\.......\\...-.....|....\\....-...../......\\\\.........../..............\\.....\\-../....................\\.........
.|\\......................./.|.\\./.|.........-.......\\........../.........-........-......................./...
../........\\.......|.\\...../......-......../.....\\............................./................./............
.\\.............................\\.../........\\.................\\....................................-..........
...............\\......|.......-....................|.......|............/-....-................-.............\\
.....\\|........|....\\.................-../........\\./...../.|.....-......................../.............|....
......-...../...|............|..-...............-...........|....\\...................\\...............\\........
./......./....|..........-.|.....|....\\-...............\\......./..............\\..|.............|..............
....|\\.......|-....../......\\........................................\\|......-.................|......|.-..||-
.-.|.......................................\\....-./\\.-....-.../......|................|.\\......./.........-...
.|.../..............|\\..................-.....................\\..\\/|......./..............\\...||.|...../..|.|.
....\\........./.....\\................--...........\\........../......\\.........................-..-........\\...
-.\\./.........\\...\\........./.......-......-...../..-....-..|....././......-........-.-......-.........../....
.....\\.............\\............|.\\|.........................-/......./...|......|.....\\.../.-./..............
.........-.........\\..../.|..................\\../........\\-............/.-../...\\.............-.|.....|.......
......./.|..................../..........-............/....-...................|.............-..........././.-
...-....\\...............\\...............................|....-.......-.....\\.../..|...........\\.......-/....|.
........|.....|..../...................|.....\\.-..-....-....../..-......\\......................|..............
.......|-.-...-\\.......|....|..........|..|..................|..................................|...\\../......
....-|/.../...-..|......-...........\\..........-.....||.............../..........\\..................|...\\.....
..................//...../..........................-..........|...........-.\\........./......................
-..-.................\\-.........\\.................../...........\\../............/...|..............-......|...
..|.|.........|..................../..../-........./.../..........\\./...........|.............................
.......|.....\\./.....|.-....|.........\\.........|......-........./...-...............|.../................./..
|..............................\\................/.|......................./.\\...............\\........\\........
....\\../..........|....../.....|...\\.........|-........|....................../............|/.............|...
..\\......-........................................\\.....|.........-/..\\........................../....|.......
.....\\-../.....\\-/....-..........-.....-.....|.......\\.......\\....../.../...../....\\\\.........................
.........../..........-....../......./........-.............\\...............\\.........-..../...-............-.
........|.....................\\..................................-.\\.\\/.|...../..-..-...\\.-.../...............
/...\\..........-.....|...................\\........./...............-.....|...|......................\\.........
................./........\\.|..............................|.........../..............\\-.........|............
...\\.......\\.../...-.../...../|-...|.../.\\.\\............................|....\\.....-.\\...../.....\\....-...\\...
....-....|............/...|...........-.......|.....-....../........................|......|......\\....\\......
-.........../\\.........|..........|.....\\.............-...../........|............../...|................/-.|/
....................../........\\................................|.....\\..\\..........\\..................|......
..|..............|......../...\\......../-.....-........\\...................................-.............|....
.......//....\\.........|../...\\.......-...-|........\\...|..........\\........................-...\\./....\\......
...-....................|..............\\......|......../-...................\\.|........\\.......-...........\\..
........./..................../\\|./..\\.......................|./..............................................
.........../..............\\.....................|.......\\..............-......-...............................
..........|../................../............................./.../...........\\......-.......-.........-..../-
-..........\\............|..|.............\\................................\\......\\..-...-..........|/....\\..-.
...-...\\../............/..|......-.............\\./.............../...............\\..............-..........|.-
...........|................-..-\\..........\\|/....-.\\.........../.........-.-......................|..........
\\.\\.................\\..../..........-/..............\\.........\\.-....\\......|........................../../...
..................................-.....|-........|......\\...........|..........|.........../.....-..../....-/
...........-.|..........-..........................|\\.\\.....|....\\....-.......................................
......|.............-.........................../............/../......................|.........-...-........
......../...-\\....\\../.......-........|.|......|.......................\\.............../......................
...-................\\....\\........../..........-\\..........................\\..-....-..........................
\\........\\.............\\.......-..-............../......./........-........|...........././............-......
............./................|.\\..........-.....\\-....\\.........\\.............\\....../.....\\.................
.................../......../................|......\\.|...........|.............-./.....|.........../.........
...\\/..........\\\\..............-\\...\\.....\\.....-.............|..........\\.......-/........|................-.
....................-...|.......-....-........-..-..................................../................\\....-.
.-//................/.....\\........\\............|............./..................../...................|......
................../.|............\\..-/....-.............-....................../......|..\\....../.............
/..\\..../.......\\-........././.-....\\..............\\.............-............................-..|............
........\\\\........./.\\.........../..|....\\..........\\.........\\....../...................\\.../-...............
..................................../.........\\.../.....|.-....../..../.....|......|.|........../.....\\|...\\..
|..|...................\\......\\.|..............|./.........|.|........-...|...................|...............
-.........|....\\........|......................./................\\........................\\...................
............/................-|-.....|.-..-.................-..........................-............|.........
.....................................\\\\................|\\...\\...-....................\\........................
.......-..-................/...................|...../..|................................\\......./............
.............../..................................|.-...............\\.../....../.......................-......
................../.......-...................................-...........\\....././...|...........\\..../...-..
......\\........\\..-.......|.....-...\\....................\\|................/-...............-.............|.|.
......//.-\\.-..|...................|.............|....../..........\\.................\\\\...................-...
.........|......./.|..--.......\\.........|..\\................|....\\...........................................
......................./|..............|.........................\\......................\\.....................
...-.............\\../........|..............\\........|.-..................-......................\\............
........\\..../......./............-/......|./|..........-...................../........|.-\\............../.\\..
.|............................................-../...................\\........../..-..|...|..|................
..........................|..................|....\\./.....|...-....-................\\..|..\\..............\\./..
...........................................|.................|.....\\...................|........-......|.-....
.....\\...........|...\\...|..........|........./.........\\./...............-............................-......
...|...........\\...................\\.................-/.........../.......|..../...../..............|.|.......
.|.......|...........\\-........\\....\\......././\\......\\.........-.......\\................\\....-...............
../..........................\\...........---|....../............-.....................|.......||./..../.......
..../...././...|\\................../..........-..../\\............//.......\\....\\.....-.|.................\\...-
..............|.............|............\\.............|....././....../...../..........|../...................
.|...|...........-..//...............................\\................../|....../................../..|.......
........\\...\\......../......../..../..\\....-\\.....-/.................................................|...\\.../
...-.../........|./........\\........./.....-......................-..-................/......|........\\......|
....|..................................|....-.\\.........\\......-................./..............|.............
...-\\.././.\\.|...........-..-.........-...............|..-...-....../|.........-......\\..../..................
..................../......../......../........................||...\\/...../................/......./...//-...
....-.....................\\........-\\...\\...........|........../.....|.........../......\\.....................
..............-.|..../........................\\|..............\\...........//....\\....-....\\...........-.......
..........................|...|.....\\.......................-..........|...|..........-............-...../....
.-..../......./|............|.|........../../..\\...../....-../\\../|.....\\.............|\\............|.........
........\\......./............-..|....|..........|.\\.\\\\..............-............\\........./.................\\
.../................-........-.-........\\........./.\\.|...........|............................/......-.......
.....\\....|-..|......\\...\\.................\\..-..........|--\\............/..../..\\...................-........
\\............\\...........|..............................\\.|........|.....-.........................\\..........
.............|..-|...................|......\\...\\-...........|....\\....|............././......|\\...........\\..
...-....................|...........-........../.......-................./......\\.........|.....\\.-.........-.
........../......\\.\\.........|-./.............................|.\\......\\../..............|...............//...
..|............/..................\\..................................|.\\.|......................../../..\\....\\
....-.-....\\\\/.......\\..........|.-......../................\\....................-.............-...../........
.\\.....|.|................\\...../...................|..............................\\.....|............|..|\\...
.-..........|.....\\-....................\\.......\\...................-|/.|........-........\\.././..|...........
.....-/.....|.........../........................-..|...........\\............|......\\..................../....
../.......-.-/.|..................../....................\\.......|.........\\........../..\\....................
.....-........-...........................\\.............\\................../...\\.......|\\...\\.|...............
.........-.....\\|.-.........|......\\....\\..........................-.|..\\........|......././....../......|....
.....................-................../...-...-...................\\./......./...-.-....-......./...\\..-.....
.\\.--./....................-................\\...............-..\\............-.../...............././.....\\....`

// 8389 - 12862

let cache: Map<`${number} ${number} ${string}`, number> = new Map()
export default function Page() {
  cache.clear()
  const map = getInputMap(puzzle)
  // Part 1 - 46
  getCount(map, 0, 0, "right")
  getCount(map, 0, 0, "right")
  getCount(map, 0, 0, "right")
  const count = getCount(map, 0, 0, "right")
  console.log("part 1",count)

  // console.log("part 2", getCount(map, 0, 3, "down"))

  // Part 2 - 51
  let maxCount = 0
  for (let i = 0; i < map[0].length; i++){
    maxCount = getCount(map, 0, i, "down") > maxCount ? getCount(map, 0, i, "down") : maxCount
    maxCount = getCount(map, map.length - 1, i, "up") > maxCount ? getCount(map, map.length - 1, i, "up") : maxCount
  }
  for (let i = 0; i < map.length; i++){
    maxCount = getCount(map, i, 0, "right") > maxCount ? getCount(map, i, 0, "right") : maxCount
    maxCount = getCount(map, i, map[0].length - 1, "left") > maxCount ? getCount(map, i, map[0].length - 1, "left") : maxCount
  }
  console.log(maxCount)
  return
}

function getCount(map: string[][], y: number, x: number, dir: "left" | "right" | "up" | "down") {
  cache.clear()
  const visited = new Map<`${number} ${number}`, true>()
  const traverse = (y: number, x: number, dir: "left" | "right" | "up" | "down") => {
    if (y < 0 || y >= map.length || x < 0 || x >= map[0].length) return 0
    // console.log(y, x, dir)
    // console.log(cache)
    const cacheitem = cache.get(`${y} ${x} ${dir}`)
    if (cacheitem !== undefined) {
      if (!visited.has(`${y} ${x}`)) {
        // console.log("Cache Hit & unvisited!", cacheitem)
        return cacheitem
      }
      else {
        // console.log("previous path visited!")
        return 0
      }
    }
    let count = 0
    cache.set(`${y} ${x} ${dir}`, count)
    const curr = map[y][x]
    if ((curr === '.' && dir === "right") || (curr === '-' && (dir === "down" || dir === "up" || dir === "right")) || (curr === '/' && dir === "up") || (curr === '\\' && dir === "down")) {
      count += traverse(y, x + 1, "right")
    }
    if ((curr === '.' && dir === "left") || (curr === '-' && (dir === "down" || dir === "up" || dir === "left")) || (curr === '/' && dir === 'down') || (curr === '\\' && dir === "up")) {
      count += traverse(y, x - 1, "left")
    }
    if ((curr === '.' && dir === "up") || (curr === '|' && (dir === "left" || dir === "right" || dir === "up")) || (curr === '/' && dir === 'right') || (curr === '\\' && dir === "left")) {
      count += traverse(y - 1, x, "up")
    }
    if ((curr === '.' && dir === "down") || (curr === '|' && (dir === "left" || dir === "right" || dir === "down")) || (curr === '/' && dir === 'left') || (curr === '\\' && dir === "right")) {
      count += traverse(y + 1, x, "down")
    }
    if (!visited.has(`${y} ${x}`)) {
      visited.set(`${y} ${x}`, true)
      count++
    }
    // console.log("pos", [y, x], "ways", count)
    cache.set(`${y} ${x} ${dir}`, count)
    return count
  }
  return traverse(y, x, dir)
}
function getInputMap(input: string) {
  return input.split('\n').map(row => row.split(''))
}
