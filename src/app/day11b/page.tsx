const sample = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

const puzzle = `.......#.....#.....................#.............#.................#.........................#..............................................
#.....................#.......#.................................................................................#.......#...................
.......................................................................#.........................#..................................#.......
................................................................#..............#..............................................#.............
.........................................#............................................................#....................................#
.................#..................................................#.......................................................................
...........................#...............................................................................#................................
....#.......#...........................................#..........................#.............................#..........................
....................#.............#........#................................................................................................
...................................................#...................................................#...................#................
.........................#........................................#..................................................#......................
......#..........#...........................................#...........#............#.....................................................
......................................#..........................................#.........................#.....................#..........
.#...................#..................................#.......................................#...........................................
............#.................................#.....................#.......................................................................
............................................................................................................................................
..............................#.....................................................................................#..................#....
....................................................................................#........#......#.......................................
.........................#.........................#............#...........................................#...............................
.#......#.....#.......................#.................#........................................................#.....#....................
...........................................................................#.................................................#..............
...............................................#.......................................#...............#..........................#.........
......................#..................#..................................................................................................
..........................................................................................................................#.................
......#...........................#.........................................................#........................#......................
..............................................................................................................................#.............
..#.......................#.................#............................................................................................#..
..................#....................................................#................#...................................................
....................................................#.....#....................#............................................................
...............................#............................................................................................................
..............................................#...............#..........................................................#...........#......
.#.........#........................#..................................................................#....................................
..........................................................................#.......................#........................................#
...................#......................................................................#.................................................
.............................................................................................................................#..............
.....#......................................................................................................................................
........................................................#........................#..........................................................
.............................#...............#.....................#.....#............#..................#..............................#...
............................................................................................#......#...........#............................
.........................#........#...................................................................................#.....................
...........................................................................................................................................#
.....................................................#.....#.................................................................#..............
#.........................................................................................................#.......................#.........
................#...........................................................#.....................#.........................................
..............................#..............#...................................#.......#...........................#......................
........#................#.........#............................#............................................#.............#.........#......
............................................................................................................................................
.......................................................#...............#.............................#...........................#..........
.............#.................................#............................................................................................
............................................................................................................................................
..#.............................................................................#...........................................#...........#...
............................................................................................................................................
......................................#..........................................................#................#.........................
............................#................#......#......................#...........#....................................................
............................................................................................................................................
....................................................................................................#................#..........#...........
.#............#...................#...............................#........................................#.............................#..
.........#...............................................................#..................................................................
.......................#....................#........#...........................................#..........................................
............................................................#.....................................................#.........................
..............................#.......................................................................#...................#.......#.........
............#.......................#...................#............................#......................................................
...................................................#......................................#..............................................#..
.#................#...................................................#........................#............................................
......#....................................................................#................................#...............................
...............................#....................................................................................#.......................
.........................#.....................#......#.............................................#.................................#.....
............................................................................................................................................
...............#.....................#....................................................#.................................................
..................................................................................................................#.........................
....#......#.....................................#..............................#............................#............#.....#...........
....................#.............................................#....................#.........#.......................................#..
.........................................................#..............#.............................#.....................................
............................#...........#...........................................................................#.......................
............................................................................................................................................
#..................................#...............................................................#..........#.............................
.......#......................................................................................#.................................#.......#...
.....................#....................#...............................#.....#......................................#....................
................................#..........................#......#....................#..........................#.........................
..............#...................................#........................................................................#...............#
....#....................................................................................................#..................................
.......................#....................................................................................................................
......................................#................................#..................#.................................................
.....................................................#............................................#...............................#.........
............................................................................................................................................
............................................................................................................................................
....#.................#..................................#.........................#..........................#.............................
.............#........................................................................................#..................#..................
......................................#............................................................................#........................
.........#....................................................#.........#............................................................#......
.............................................................................................#..............................................
.............................#...........#............................................................................#.....................
#..................#................................................#....................#.......................................#.........#
...................................................................................................#......#.................................
...........#.............................................#...........................#......................................................
....................................#.......................................................................................................
..................................................#..........#.........#......................#.....................#.......................
.#......#....................................#..............................................................#...............................
.............................#.............................................#................................................................
.......................#...............................................................................#....................#...............
....................................................#.....................................#...........................................#.....
................#.....................#..................#.................................................................................#
...#.....#..........................................................#................#......................................................
.............................................#...............#................................#......#......................................
...............................#...............................................#............................................................
.............................................................................................................................#.........#....
.....................#................................................#.................................................#...................
...............#.........................#.......................#..................#.......................................................
.....#......................................................................................................#.......................#.......
....................................#.................#.........................#..................#........................................
........................................................................................................................................#...
.........#..............#.....................................#........................................#.....................#..............
...............................................#...................#........................................................................
......................................#.............#..................................#.....#.......................#......................
............#.....#...............................................................................#.........................................
...#...................................................................................................................................#....
.......................#.........................#..........................................................................................
.........................................................#...........#.........................#........#..........#.............#..........
............................#..............#....................#........................................................#..................
.......#.................................................................#................#.................................................
.................#..................................................................................#........................#...........#..
...................................................#.......#................................................................................
.........................................#......................................#......................................#....................
....................................#...........................................................................#...........................
..............................#.............................................................#...........#.......................#......#....
.........#...............................................#..............#...................................................................
........................#....................#.....................................#........................................................
#...........................................................................................................................................
............................#......................................................................#.......#................................
......................................#.....................................................................................................
.....#............#.........................................#..........................#..........................................#.........
...........................................#......................#..............................................#..........................
..............#..............................................................................#............................#.............#...
..#......#...........................................#..............................#..................#.....#..............................
....................#..........#.....#...............................#......................................................................
............................................................................................................................................
.................................................#..........................................................................................
.............#..........#...............................#...............#.............#..........#.........#........#.......................
............................................#................#.................#............................................................
....................................#....................................................................................#.............#....`

const { abs } = Math

export default function Page() {
  const input = puzzle
  const rows = input.split('\n')

  let lengthSum = 0

  const map = new2DArr(rows.length, rows[0].length, '0')
  const maxY = () => map.length
  const maxX = () => map[0].length


  for (let y = 0; y < maxY(); y++) {
    for (let x = 0; x < maxX(); x++) {
      map[y][x] = rows[y][x]
    }
  }

  const VGAP = '|'
  const HGAP = '-'
  const VHGAP = '+'

  // Expansion
  for (let y = 0; y < maxY(); y++) {
    if (!map[y].find(c => c === '#')) {
      for (let x = 0; x < maxX(); x++) {
        map[y][x] = HGAP
      }
    }
  }


  for (let x = 0; x < maxX(); x++) {
    let hasGalaxy = false
    for (let y = 0; y < maxY(); y++) {
      if (map[y][x] === '#') {
        hasGalaxy = true
        break
      }
    }
    if (!hasGalaxy) {
      for (let y = 0; y < maxY(); y++) {
        if (map[y][x] === HGAP) map[y][x] = VHGAP
        else map[y][x] = VGAP
        // map[y].splice(x, 0, '.')
      }
      // x++
    }
  }

  console.log(map.map(row => row.join('')).join('\n'))


  const galaxies: { relX: number, relY: number }[] = []

  const EXPANSION_GAP = 1000000

  for (let y = 0, relY = 0; y < maxY(); y++, relY++) {

    if(map[y][0] === HGAP) relY += EXPANSION_GAP - 1

    for (let x = 0, relX = 0; x < maxX(); x++, relX++) {
      const curr = map[y][x]

      if (curr === VGAP || curr === VHGAP) {
        if (y === 9) {
          console.log("Passed VGAP!")
        }
        relX += EXPANSION_GAP - 1
      }

      if (curr === '#') {
        // console.log("Galaxy Found!")
        galaxies.forEach(g => {
          const dist = (abs(relY - g.relY) + abs(relX - g.relX))
          if (galaxies.length === 7) {
            console.log(`Galaxy at ${relY} ${relX} and ${g.relY} ${g.relX}: ${dist}`)
          }
          lengthSum += dist
        })
        galaxies.push({ relX, relY })
      }

    }
  }

  console.log(lengthSum)
  return lengthSum

}


function new2DArr<T>(row: number, col: number, initial: T) {
  return new Array(row).fill(0).map<T[]>(() => new Array(col).fill(initial))
}

// 374 <- 1 gap
// 82000210 <- 1000000 gap

// 9805264 <- 1 gap
// 779032247216 <- 1000000 gap